# ๐ Analytics System Architecture

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     INCUBAZAR ANALYTICS SYSTEM                  โ
โ                      Production-Ready v1.0                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        USER ACTIVITY FLOW                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

    User Actions                   Tracking Layer               Database
    โโโโโโโโโโโโ                   โโโโโโโโโโโโโโ              โโโโโโโโโโ
    
    ๐ง Login                    โโโถ  trackLogin()        โโโถ  user_activity_events
    ๐  View Deal               โโโถ  trackDealView()     โโโถ  user_activity_events
    โ๏ธ  Create Deal             โโโถ  trackDealCreate()   โโโถ  user_activity_events
    ๐ฌ Send Message             โโโถ  trackMessage()      โโโถ  user_activity_events
    ๐ฐ Express Interest         โโโถ  trackInterest()     โโโถ  user_activity_events
    ๐ View Learning Module     โโโถ  trackLearningView() โโโถ  user_activity_events

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     METRICS CALCULATION FLOW                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

    Raw Events                  Aggregation                 Metrics Output
    โโโโโโโโโโ                  โโโโโโโโโโโ                โโโโโโโโโโโโโโโ
    
    user_activity_events
         โ
         โโโโถ calculate_dau()  โโโถ  DAU (Daily Active Users)
         โ
         โโโโถ calculate_wau()  โโโถ  WAU (Weekly Active Users)
         โ
         โโโโถ calculate_mau()  โโโถ  MAU (Monthly Active Users)
         โ
         โโโโถ update_daily_metrics()  โโโถ  platform_metrics table
                                            โ
                                            โโโโถ DAU/MAU Ratio (Stickiness)
                                            โโโโถ Growth Rate
                                            โโโโถ Engagement Levels
                                            โโโโถ Business KPIs

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      DATABASE SCHEMA OVERVIEW                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

    โโโโโโโโโโโโโโโโโโโโโโโ
    โ user_activity_eventsโ  โโโ Every user action stored here
    โโโโโโโโโโโโโโโโโโโโโโโค
    โ โข user_id           โ
    โ โข event_type        โ  (login, deal_view, message_sent, etc.)
    โ โข event_category    โ  (engagement, transaction, content)
    โ โข metadata          โ  (additional context)
    โ โข created_at        โ
    โโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โ Aggregated Daily via
              โ update_daily_metrics()
              โผ
    โโโโโโโโโโโโโโโโโโโโโโโ
    โ  platform_metrics   โ  โโโ Daily snapshot of all metrics
    โโโโโโโโโโโโโโโโโโโโโโโค
    โ โข date              โ  (unique per day)
    โ โข dau, wau, mau     โ  (engagement metrics)
    โ โข new_signups       โ  (growth)
    โ โข deals_created     โ  (activity)
    โ โข investments_made  โ  (transactions)
    โ โข retention_rate    โ  (health)
    โโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โ Powers
              โผ
    โโโโโโโโโโโโโโโโโโโโโโโ
    โ  Admin Dashboard    โ  โโโ /admin/analytics
    โโโโโโโโโโโโโโโโโโโโโโโค
    โ โข Charts & Graphs   โ
    โ โข Real-time Stats   โ
    โ โข Export to CSV     โ
    โ โข Insights          โ
    โโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     KEY METRICS EXPLAINED                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

    Metric              Formula                     Meaning
    โโโโโโ              โโโโโโโ                     โโโโโโโ
    
    DAU                 Unique users / 24hrs        Daily engagement
    WAU                 Unique users / 7 days       Weekly engagement  
    MAU                 Unique users / 30 days      Monthly engagement
    
    DAU/MAU Ratio       (DAU รท MAU) ร 100          Stickiness (how often users return)
                        
                        ๐ Benchmarks:
                        โข 10-15%  = Okay
                        โข 20-30%  = Good (marketplace target)
                        โข 40%+    = Excellent
                        โข 60%+    = World-class
    
    DAU/WAU Ratio       (DAU รท WAU) ร 100          Daily engagement rate
                        Target: 60%+

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      ANALYTICS DASHBOARD TABS                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

    โโโโโโโโโโโโโโโโโโโ
    โ  ENGAGEMENT TAB โ
    โโโโโโโโโโโโโโโโโโโค
    โ โข DAU/WAU/MAU Trend (Line Chart)
    โ โข Engagement Distribution (Pie Chart)
    โ โข Stickiness Ratio (Area Chart)
    โโโโโโโโโโโโโโโโโโโ

    โโโโโโโโโโโโโโโโโโโ
    โ   GROWTH TAB    โ
    โโโโโโโโโโโโโโโโโโโค
    โ โข New Signups (Bar Chart)
    โ โข Month-over-Month Growth (%)
    โ โข User Acquisition Trends
    โโโโโโโโโโโโโโโโโโโ

    โโโโโโโโโโโโโโโโโโโ
    โ  ACTIVITY TAB   โ
    โโโโโโโโโโโโโโโโโโโค
    โ โข Deals Created vs Investments
    โ โข Messages Sent
    โ โข Content Views
    โโโโโโโโโโโโโโโโโโโ

    โโโโโโโโโโโโโโโโโโโ
    โ   TRENDS TAB    โ
    โโโโโโโโโโโโโโโโโโโค
    โ โข Weekly Trends
    โ โข Week-over-Week Comparison
    โ โข Seasonal Patterns
    โโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     AUTOMATION & SCHEDULING                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

    Daily (Midnight UTC)
    โโโโโโโโโโโโโโโโโโโโ
    
    Supabase pg_cron
         โ
         โโโโถ Run: update_daily_metrics()
         โ         โ
         โ         โโโโถ Calculate DAU, WAU, MAU
         โ         โโโโถ Aggregate activity counts
         โ         โโโโถ Calculate retention rates
         โ         โโโโถ Update platform_metrics table
         โ
         โโโโถ Result: Fresh metrics available every morning

    Setup Command:
    โโโโโโโโโโโโโโ
    SELECT cron.schedule(
      'update-daily-metrics',
      '0 0 * * *',
      $$ SELECT update_daily_metrics(); $$
    );

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        INTEGRATION POINTS                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

    Where to Add Tracking:
    โโโโโโโโโโโโโโโโโโโโโโ
    
    โ Auth Callback                 โโโถ  trackLogin(userId)
    โ Deal Detail Page              โโโถ  trackDealView(userId, dealId)
    โ Create Deal Success           โโโถ  trackDealCreate(userId, dealId)
    โ Message Send Handler          โโโถ  trackMessage(userId, recipientId)
    โ Interest Express Handler      โโโถ  trackInterest(userId, dealId, amount)
    โ Learning Module Page          โโโถ  trackLearningView(userId, path)

    Example Code:
    โโโโโโโโโโโโโ
    
    import { trackDealView } from '@/lib/analytics'
    
    useEffect(() => {
      if (userId && dealId) {
        trackDealView(userId, dealId)
      }
    }, [userId, dealId])

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      SECURITY & PRIVACY                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

    RLS Policies:
    โโโโโโโโโโโโโ
    
    โข user_activity_events       โโโถ  Users: INSERT own | Admins: SELECT all
    โข platform_metrics           โโโถ  Admins only
    โข user_engagement_scores     โโโถ  Users: SELECT own | Admins: SELECT all
    โข daily_active_users         โโโถ  Admins only
    โข user_sessions              โโโถ  Users: SELECT own | Admins: SELECT all

    Data Retention:
    โโโโโโโโโโโโโโโ
    
    โข Raw events: 90 days (configurable)
    โข Aggregated metrics: Forever
    โข Personal data: Anonymized after 30 days of inactivity

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        SUCCESS CRITERIA                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

    Month 1 Targets:
    โโโโโโโโโโโโโโโโ
    โ MAU: 100+ users
    โ DAU/MAU: 15%+
    โ Active Deals: 20+
    
    Month 3 Targets:
    โโโโโโโโโโโโโโโโ
    โ MAU: 500+ users
    โ DAU/MAU: 20%+
    โ Active Deals: 100+
    
    Month 6 Targets:
    โโโโโโโโโโโโโโโโ
    โ MAU: 1,500+ users
    โ DAU/MAU: 25%+
    โ Total Raised: โน5 Cr+

    Month 12 Targets:
    โโโโโโโโโโโโโโโโโ
    โ MAU: 5,000+ users
    โ DAU/MAU: 30%+
    โ Total Raised: โน25 Cr+

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      EXPORT & REPORTING                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

    CSV Export includes:
    โโโโโโโโโโโโโโโโโโโโ
    
    โข Date
    โข DAU, WAU, MAU
    โข DAU/MAU Ratio (%)
    โข Total Users
    โข New Signups
    โข Deals Created
    โข Investments Made
    โข Total Invested (โน)
    โข Retention Rate (%)
    
    Usage:
    โโโโโโ
    
    Click "Export CSV" button in /admin/analytics
    โโโถ Download: incubazar-metrics-YYYY-MM-DD.csv
    โโโถ Use in: Excel, Google Sheets, Business Intelligence tools

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         NEXT STEPS                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

    Phase 2 (Recommended):
    โโโโโโโโโโโโโโโโโโโโโโ
    
    โก Cohort Analysis (retention by signup month)
    โก Funnel Analytics (signup โ deal โ investment)
    โก A/B Testing Framework
    โก Predictive Analytics (churn prediction)
    โก Custom Alerts (DAU drops, growth spikes)
    
    Phase 3 (Advanced):
    โโโโโโโโโโโโโโโโโโโ
    
    โก Real-time Dashboard (WebSocket updates)
    โก ML-based Recommendations
    โก Revenue Forecasting
    โก User Segmentation (RFM Analysis)
    โก Automated Weekly Reports via Email

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

                    ๐ ANALYTICS SYSTEM READY! ๐
                    
                Your admin panel is now equipped with
                world-class analytics capabilities!

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## Quick Reference

**Access:** `/admin/analytics`

**Track Event:**
```typescript
import { trackLogin } from '@/lib/analytics'
await trackLogin(userId)
```

**Update Metrics:**
```sql
SELECT update_daily_metrics();
```

**Export Data:** Click "Export CSV" button

**Documentation:** See `ADMIN_ANALYTICS_SYSTEM.md`
